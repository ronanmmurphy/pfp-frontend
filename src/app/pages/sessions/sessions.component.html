<div class="py-3">
  <!-- Filters -->
  <div class="card mb-3">
    <div class="card-body">
      <div class="row g-3 align-items-end">
        <div class="col-md-2">
          <label class="form-label">View</label>
          <div class="btn-group w-100" role="group">
            <button
              type="button"
              class="btn btn-outline-primary btn-sm"
              [class.active]="selectedView === 'thisMonth'"
              (click)="setView('thisMonth')"
            >
              This Month
            </button>
            <button
              type="button"
              class="btn btn-outline-primary btn-sm"
              [class.active]="selectedView === 'waitlist'"
              (click)="setView('waitlist')"
            >
              Waitlist
            </button>
            <button type="button" class="btn btn-outline-primary btn-sm" [class.active]="selectedView === 'all'" (click)="setView('all')">
              All
            </button>
          </div>
        </div>

        <div class="col-md-2">
          <label class="form-label">Search</label>
          <input
            type="text"
            class="form-control form-control-sm"
            placeholder="Search by photographer or client"
            [formControl]="form.controls.search"
          />
        </div>

        <div class="col-md-2">
          <label class="form-label">Status</label>
          <select class="form-control form-control-sm" [formControl]="form.controls.status">
            <option value="null">All</option>
            <option [ngValue]="SessionStatus.SCHEDULED">Scheduled</option>
            <option [ngValue]="SessionStatus.COMPLETED">Completed</option>
            <option [ngValue]="SessionStatus.CANCELED">Canceled</option>
          </select>
        </div>

        <div class="col-md-2">
          <label class="form-label">From</label>
          <input type="date" class="form-control form-control-sm" [formControl]="form.controls.dateFrom" />
        </div>

        <div class="col-md-2">
          <label class="form-label">To</label>
          <input type="date" class="form-control form-control-sm" [formControl]="form.controls.dateTo" />
        </div>

        <div class="col-md-2">
          <button class="btn btn-primary w-100 mb-2" type="button" (click)="createSession()" *ngIf="currentUser?.role !== UserRole.VETERAN">
            Create a Session
          </button>
          <button class="btn btn-primary w-100 mb-2" type="button" (click)="getReferral()" *ngIf="currentUser?.role === UserRole.VETERAN">
            Get a Referral
          </button>
          <button class="btn btn-outline-primary w-100" (click)="resetFilters()">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sessions -->
  <div class="card">
    <div class="card-header d-flex align-items-center justify-content-between">
      <h4>
        {{ selectedView === 'thisMonth' ? 'Sessions of This Month' : selectedView === 'waitlist' ? 'Waitlist' : 'All Sessions' }}
      </h4>
      <div *ngIf="currentUser?.role === UserRole.PHOTOGRAPHER" class="d-flex align-items-center gap-4">
        <h5>{{ rows.length }} sessions / {{ currentUser?.maxSessionsPerMonth || 'NaN' }}</h5>
        <button class="btn btn-primary" (click)="setMaxSessionsPerMonth()">
          <i antIcon type="setting" theme="outline"></i>
        </button>
      </div>
    </div>
    <div class="card-body">
      <div *ngIf="loading" class="text-muted mb-2">Loadingâ€¦</div>

      <div class="table-responsive" *ngIf="!loading">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th>Session Name</th>
              <th>Date</th>
              <th>Status</th>
              <th *ngIf="currentUser?.role !== UserRole.PHOTOGRAPHER">Photographer</th>
              <th *ngIf="currentUser?.role === UserRole.VETERAN">Contact</th>
              <th *ngIf="currentUser?.role === UserRole.VETERAN">Location</th>
              <th *ngIf="currentUser?.role !== UserRole.VETERAN">Client</th>
              <th *ngIf="currentUser?.role === UserRole.PHOTOGRAPHER">Contact</th>
              <th *ngIf="currentUser?.role === UserRole.PHOTOGRAPHER">Location</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of rows; trackBy: trackById">
              <td>{{ s.name }}</td>
              <td>{{ s.date | date: 'medium' }}</td>
              <td>
                <span class="d-block">
                  <i class="badge-circle f-10 m-r-5" [ngClass]="getSessionBadgeClass(s.status)"></i>
                  {{ getSessionStatusText(s.status) }}
                </span>
              </td>
              <td *ngIf="currentUser?.role !== UserRole.PHOTOGRAPHER">
                {{ getFullName(s.photographer.firstName, s.photographer.lastName) }}
              </td>
              <td *ngIf="currentUser?.role === UserRole.VETERAN">
                <p>{{ s.photographer?.email || 'No Email' }}</p>
                <p>{{ s.photographer?.phoneNumber || 'No Phone' }}</p>
              </td>
              <td *ngIf="currentUser?.role === UserRole.VETERAN">
                {{
                  getLocationText(
                    s.photographer.streetAddress1,
                    s.photographer.city,
                    s.photographer.state,
                    s.photographer.postalCode,
                    s.photographer?.streetAddress2
                  )
                }}
              </td>
              <td *ngIf="currentUser?.role !== UserRole.VETERAN">{{ getFullName(s.veteran.firstName, s.veteran.lastName) }}</td>
              <td *ngIf="currentUser?.role === UserRole.PHOTOGRAPHER">
                <p>{{ s.veteran?.email || 'No Email' }}</p>
                <p>{{ s.veteran?.phoneNumber || 'No Phone' }}</p>
              </td>
              <td *ngIf="currentUser?.role === UserRole.PHOTOGRAPHER">
                {{
                  getLocationText(
                    s.veteran.streetAddress1,
                    s.veteran.city,
                    s.veteran.state,
                    s.veteran.postalCode,
                    s.veteran?.streetAddress2
                  )
                }}
              </td>
              <td>
                <div ngbDropdown class="d-inline-block" container="body">
                  <button class="btn btn-outline-primary btn-sm" ngbDropdownToggle [disabled]="loading">Actions</button>
                  <div ngbDropdownMenu>
                    <button ngbDropdownItem (click)="editSession(s)">{{ currentUser?.role === UserRole.VETERAN ? 'View' : 'Edit' }}</button>
                    <!-- <button
                      ngbDropdownItem
                      (click)="openRescheduleModal(s)"
                      *ngIf="
                        currentUser?.role !== UserRole.VETERAN &&
                        (s.status === SessionStatus.SCHEDULED || s.status === SessionStatus.RESCHEDULED)
                      "
                    >
                      Reschedule
                    </button>
                    <button
                      ngbDropdownItem
                      (click)="updateSessionStatus(s.id, SessionStatus.COMPLETED)"
                      *ngIf="
                        currentUser?.role !== UserRole.VETERAN &&
                        (s.status === SessionStatus.SCHEDULED || s.status === SessionStatus.RESCHEDULED)
                      "
                    >
                      Complete
                    </button>
                    <button
                      ngbDropdownItem
                      (click)="updateSessionStatus(s.id, SessionStatus.CANCELED)"
                      *ngIf="
                        currentUser?.role !== UserRole.VETERAN &&
                        (s.status === SessionStatus.SCHEDULED || s.status === SessionStatus.RESCHEDULED)
                      "
                    >
                      Cancel
                    </button> -->
                  </div>
                </div>
              </td>
            </tr>
            <tr *ngIf="rows.length === 0">
              <td class="text-muted">No sessions found.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="d-flex justify-content-between align-items-center mt-3">
        <div>
          <label class="me-2">Rows per page:</label>
          <select class="form-select d-inline-block" style="width: auto" [ngModel]="pageSize" (ngModelChange)="changePageSize($event)">
            <option [ngValue]="10">10</option>
            <option [ngValue]="20">20</option>
            <option [ngValue]="50">50</option>
          </select>
        </div>

        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-outline-secondary" [disabled]="page <= 1" (click)="prevPage()">Prev</button>
          <span>Page {{ page }} / {{ totalPages }}</span>
          <button class="btn btn-outline-secondary" [disabled]="page >= totalPages" (click)="nextPage()">Next</button>
        </div>
      </div>
    </div>
  </div>
</div>
