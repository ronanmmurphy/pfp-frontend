<div class="modal fade" [ngClass]="{ show: true }" style="display: block" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ isEdit ? 'Edit User' : 'Add User' }}</h5>
        <button type="button" class="btn-close" (click)="cancelUser()" [disabled]="submitting"></button>
      </div>
      <div class="modal-body" [formGroup]="form">
        <div class="form-group mb-3">
          <label class="form-label" for="role">
            Role
            <span class="text-danger">*</span>
          </label>
          <select
            id="role"
            class="form-select"
            formControlName="role"
            [ngClass]="{ 'is-invalid': invalid('role') }"
            [attr.disabled]="submitting || isEdit ? true : null"
          >
            <option [ngValue]="UserRole.ADMIN">Admin</option>
            <option [ngValue]="UserRole.PHOTOGRAPHER">Photographer</option>
            <option [ngValue]="UserRole.VETERAN">Veteran</option>
          </select>
          <div class="invalid-feedback" *ngIf="invalid('role')">Role is required.</div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label class="form-label" for="firstName">
                First Name
                <span class="text-danger">*</span>
              </label>
              <input
                id="firstName"
                type="text"
                class="form-control"
                formControlName="firstName"
                placeholder="First Name"
                [ngClass]="{ 'is-invalid': invalid('firstName') }"
                [attr.disabled]="submitting ? true : null"
              />
              <div class="invalid-feedback" *ngIf="invalid('firstName')">First name is required.</div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label class="form-label" for="lastName">
                Last Name
                <span class="text-danger">*</span>
              </label>
              <input
                id="lastName"
                type="text"
                class="form-control"
                formControlName="lastName"
                placeholder="Last Name"
                [ngClass]="{ 'is-invalid': invalid('lastName') }"
                [attr.disabled]="submitting ? true : null"
              />
              <div class="invalid-feedback" *ngIf="invalid('lastName')">Last name is required.</div>
            </div>
          </div>
        </div>

        <div class="form-group mb-3">
          <label class="form-label" for="email">
            Email Address
            <span class="text-danger">*</span>
          </label>
          <input
            id="email"
            type="email"
            class="form-control"
            formControlName="email"
            placeholder="Email Address"
            [ngClass]="{ 'is-invalid': invalid('email') }"
            [attr.disabled]="submitting ? true : null"
          />
          <div class="invalid-feedback" *ngIf="invalid('email')">
            {{ error('email', 'email') ? 'Enter a valid email.' : 'Email is required.' }}
          </div>
        </div>

        <ng-container *ngIf="!isEdit">
          <div class="form-group mb-3">
            <label class="form-label" for="password">
              Password
              <span class="text-danger">*</span>
            </label>
            <input
              id="password"
              type="password"
              class="form-control"
              formControlName="password"
              placeholder="Password"
              [ngClass]="{ 'is-invalid': invalid('password') }"
              [attr.disabled]="submitting ? true : null"
            />
            <div class="invalid-feedback" *ngIf="invalid('password')">
              {{ error('password', 'minlength') ? 'Min 6 characters.' : 'Password is required.' }}
            </div>
          </div>

          <div class="form-group mb-3">
            <label class="form-label" for="passwordConfirm">
              Confirm Password
              <span class="text-danger">*</span>
            </label>
            <input
              id="passwordConfirm"
              type="password"
              class="form-control"
              formControlName="passwordConfirm"
              placeholder="Confirm Password"
              [attr.disabled]="submitting ? true : null"
            />
            <small
              class="text-danger"
              *ngIf="form.errors?.['passwordsMismatch'] && (f['passwordConfirm'].touched || f['password'].touched)"
            >
              Passwords do not match
            </small>
          </div>
        </ng-container>

        <ng-container *ngIf="f['role'].value !== UserRole.ADMIN">
          <div class="form-group mb-3">
            <label class="form-label" for="phoneNumber">
              Phone Number
              <span class="text-danger">*</span>
            </label>
            <input
              id="phoneNumber"
              type="tel"
              class="form-control"
              formControlName="phoneNumber"
              placeholder="Phone Number"
              [ngClass]="{ 'is-invalid': invalid('phoneNumber') }"
              [attr.disabled]="submitting ? true : null"
            />
            <div class="invalid-feedback" *ngIf="invalid('phoneNumber')">Phone number is required.</div>
          </div>

          <div class="form-group mb-3">
            <label class="form-label" for="streetAddress1">
              Street Address
              <span class="text-danger">*</span>
            </label>
            <input
              id="streetAddress1"
              type="text"
              class="form-control"
              formControlName="streetAddress1"
              placeholder="Street Address"
              [ngClass]="{ 'is-invalid': invalid('streetAddress1') }"
              [attr.disabled]="submitting ? true : null"
            />
            <div class="invalid-feedback" *ngIf="invalid('streetAddress1')">Street address is required.</div>
          </div>

          <div class="form-group mb-3">
            <label class="form-label" for="streetAddress2">Street Address Line 2</label>
            <input
              id="streetAddress2"
              type="text"
              class="form-control"
              formControlName="streetAddress2"
              placeholder="Street Address Line 2"
              [attr.disabled]="submitting ? true : null"
            />
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group mb-3">
                <label class="form-label" for="city">City</label>
                <input
                  id="city"
                  type="text"
                  class="form-control"
                  formControlName="city"
                  placeholder="City"
                  [attr.disabled]="submitting ? true : null"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group mb-3">
                <label class="form-label" for="state">State</label>
                <select id="state" class="form-select" formControlName="state" [attr.disabled]="submitting ? true : null">
                  <option [ngValue]="''">--</option>
                  <option *ngFor="let state of usStates" [ngValue]="state">{{ state }}</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row align-items-end">
            <div class="col-md-6">
              <div class="form-group mb-3">
                <label class="form-label" for="postalCode">Postal / Zip Code</label>
                <input
                  id="postalCode"
                  type="text"
                  class="form-control"
                  formControlName="postalCode"
                  placeholder="Postal / Zip Code"
                  [attr.disabled]="submitting ? true : null"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group mb-3">
                <button type="button" class="btn btn-outline-primary w-100" (click)="verifyAddress()">Verify Address</button>
              </div>
            </div>
          </div>

          <div *ngIf="verifying" class="text-center mb-3">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <ng-container *ngIf="!verifying">
            <div class="form-group mb-3">
              <label class="form-label">
                Select your exact address:
                <span class="text-danger">*</span>
              </label>
              <select class="form-select" (change)="selectAddress($event)">
                <option value="">-- Select --</option>
                <option *ngFor="let sug of suggestions; let i = index" [value]="i">{{ sug.displayName }}</option>
              </select>
            </div>
          </ng-container>

          <ng-container *ngIf="selectedDisplay">
            <p class="text-muted">Selected Address: {{ selectedDisplay }}</p>
          </ng-container>

          <div class="text-danger" *ngIf="invalid('latitude') && f['streetAddress1'].value">Please verify and select your address.</div>

          <div class="form-group mb-3" *ngIf="f['role'].value === UserRole.PHOTOGRAPHER">
            <label class="form-label" for="website">
              Link To Professional Portfolio
              <span class="text-danger">*</span>
            </label>
            <input
              id="website"
              type="text"
              class="form-control"
              formControlName="website"
              placeholder="Link To Professional Portfolio"
              [ngClass]="{ 'is-invalid': invalid('website') }"
              [attr.disabled]="submitting ? true : null"
            />
            <div class="invalid-feedback" *ngIf="invalid('website')">Portfolio link is required for photographers.</div>
          </div>

          <ng-container *ngIf="f['role'].value === UserRole.VETERAN">
            <div class="form-group mb-3">
              <label class="form-label">
                Are You Currently Seeking Employment?
                <span class="text-danger">*</span>
              </label>
              <div class="form-check form-check-inline">
                <input
                  id="seekYes"
                  class="form-check-input"
                  type="radio"
                  [value]="true"
                  formControlName="seekingEmployment"
                  [attr.disabled]="submitting ? true : null"
                />
                <label class="form-check-label" for="seekYes">Yes</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  id="seekNo"
                  class="form-check-input"
                  type="radio"
                  [value]="false"
                  formControlName="seekingEmployment"
                  [attr.disabled]="submitting ? true : null"
                />
                <label class="form-check-label" for="seekNo">No</label>
              </div>
              <div class="invalid-feedback d-block" *ngIf="invalid('seekingEmployment')">Please choose Yes or No.</div>
            </div>

            <div class="form-group mb-3">
              <label class="form-label" for="linkedinProfile">LinkedIn Profile</label>
              <input
                id="linkedinProfile"
                type="url"
                class="form-control"
                formControlName="linkedinProfile"
                placeholder="LinkedIn Profile"
                [attr.disabled]="submitting ? true : null"
              />
            </div>

            <div class="form-group mb-3">
              <label class="form-label">
                Please Select Your Eligibility
                <span class="text-danger">*</span>
              </label>
              <div class="form-check">
                <input
                  id="tsm"
                  class="form-check-input"
                  type="radio"
                  [value]="Eligibility.TRANSITIONING_SERVICE_MEMBER"
                  formControlName="eligibility"
                  [attr.disabled]="submitting ? true : null"
                />
                <label class="form-check-label" for="tsm">Transitioning Service Member</label>
              </div>
              <div class="form-check">
                <input
                  id="gsfm"
                  class="form-check-input"
                  type="radio"
                  [value]="Eligibility.GOLD_STAR_FAMILY_MEMBER"
                  formControlName="eligibility"
                  [attr.disabled]="submitting ? true : null"
                />
                <label class="form-check-label" for="gsfm">Gold Star Family Member</label>
              </div>
              <div class="form-check">
                <input
                  id="spouse"
                  class="form-check-input"
                  type="radio"
                  [value]="Eligibility.MILITARY_SPOUSE"
                  formControlName="eligibility"
                  [attr.disabled]="submitting ? true : null"
                />
                <label class="form-check-label" for="spouse">Military Spouse</label>
              </div>
              <div class="invalid-feedback d-block" *ngIf="invalid('eligibility')">Please select your eligibility.</div>
            </div>

            <div class="form-group mb-3">
              <label class="form-label">
                Military Branch Affiliation
                <span class="text-danger">*</span>
              </label>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-check">
                    <input
                      id="airforce"
                      class="form-check-input"
                      type="radio"
                      [value]="MilitaryBranchAffiliation.US_AIR_FORCE"
                      formControlName="militaryBranchAffiliation"
                      [attr.disabled]="submitting ? true : null"
                    />
                    <label class="form-check-label" for="airforce">US Air Force</label>
                  </div>
                  <div class="form-check">
                    <input
                      id="army"
                      class="form-check-input"
                      type="radio"
                      [value]="MilitaryBranchAffiliation.US_ARMY"
                      formControlName="militaryBranchAffiliation"
                      [attr.disabled]="submitting ? true : null"
                    />
                    <label class="form-check-label" for="army">US Army</label>
                  </div>
                  <div class="form-check">
                    <input
                      id="coastguard"
                      class="form-check-input"
                      type="radio"
                      [value]="MilitaryBranchAffiliation.US_COST_GUARD"
                      formControlName="militaryBranchAffiliation"
                      [attr.disabled]="submitting ? true : null"
                    />
                    <label class="form-check-label" for="coastguard">US Coast Guard</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-check">
                    <input
                      id="navy"
                      class="form-check-input"
                      type="radio"
                      [value]="MilitaryBranchAffiliation.US_NAVY"
                      formControlName="militaryBranchAffiliation"
                      [attr.disabled]="submitting ? true : null"
                    />
                    <label class="form-check-label" for="navy">US Navy</label>
                  </div>
                  <div class="form-check">
                    <input
                      id="marine"
                      class="form-check-input"
                      type="radio"
                      [value]="MilitaryBranchAffiliation.US_MARINE_CORPS"
                      formControlName="militaryBranchAffiliation"
                      [attr.disabled]="submitting ? true : null"
                    />
                    <label class="form-check-label" for="marine">US Marine Corps</label>
                  </div>
                  <div class="form-check">
                    <input
                      id="spaceforce"
                      class="form-check-input"
                      type="radio"
                      [value]="MilitaryBranchAffiliation.US_SPACE_FORCE"
                      formControlName="militaryBranchAffiliation"
                      [attr.disabled]="submitting ? true : null"
                    />
                    <label class="form-check-label" for="spaceforce">US Space Force</label>
                  </div>
                </div>
                <div class="invalid-feedback d-block" *ngIf="invalid('militaryBranchAffiliation')">Please select your branch.</div>
              </div>
            </div>

            <div class="form-group mb-3">
              <label class="form-label" for="militaryETSDate">
                Military ETS Date
                <span class="text-danger">*</span>
              </label>
              <input
                id="militaryETSDate"
                type="date"
                class="form-control"
                formControlName="militaryETSDate"
                [ngClass]="{ 'is-invalid': invalid('militaryETSDate') }"
                [attr.disabled]="submitting ? true : null"
              />
              <div class="invalid-feedback d-block" *ngIf="invalid('militaryETSDate')">Please select Military ETS Date.</div>
            </div>
          </ng-container>

          <div class="form-group mb-3">
            <label class="form-label" for="referredBy">Were you referred by anyone?</label>
            <input
              id="referredBy"
              type="text"
              class="form-control"
              formControlName="referredBy"
              placeholder="Were you referred by anyone?"
              [attr.disabled]="submitting ? true : null"
            />
          </div>
        </ng-container>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="saveUser()" [disabled]="submitting">
          {{ submitting ? 'Saving...' : isEdit ? 'Update' : 'Create' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="cancelUser()" [disabled]="submitting">Cancel</button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade show"></div>
